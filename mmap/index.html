<!DOCTYPE HTML>
<html>
<head>
        <title>Marauder's Map</title>
        <link rel="stylesheet" href="mapstyles.css"/>
</head>
<body id="mainBody">
        <div id="sideTable"></div>
        <div id="map"></div>
        <script type="text/javascript"
                src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>
        <script type="text/javascript">
                var map;
                var login = "ErnieMacmillan";
                var markers = {};
                function InitializeMap() {
                        var mapOptions = {
                                center: {lat: 42.35674,
                                         lng: -71.08608},
                                zoom: 13
                        };
                        map = new google.maps.Map(
                                        document.getElementById('map'),
                                        mapOptions);
                }
                google.maps.event.addDomListener(window, 'load', InitializeMap);

                function SendLocationInfo(position) {
                       function LocationRequestStateChange() {
                                if (locationxhr.status == 200 && 
                                    locationxhr.readyState == 4) {
                                        parsedresponse = JSON.parse(locationxhr.responseText);
                                        parsedresponse.students.forEach(RenderStudent);
                                        parsedresponse.characters.forEach(RenderCharacter);
                                // Update the map with the response
                                }
                        }
                        var locationxhr = new XMLHttpRequest();
                        locationxhr.onreadystatechange =
                                LocationRequestStateChange;
                        locationxhr.open("post",
                                        "http://chickenofthesea.herokuapp.com/sendLocation", true);
                        locationxhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                        var params = "login=" +
                                        login +
                                        "&lat=" +
                                        position.coords.latitude +
                                        "&lng=" +
                                        position.coords.longitude;
                        locationxhr.send(params);
                }
 
                function RenderStudent(student) {
                        console.log(student);
                }

                function RenderCharacter(character) {
                        console.log(character);
                }
                navigator.geolocation.watchPosition(SendLocationInfo);
        </script>
</body>
</html>
